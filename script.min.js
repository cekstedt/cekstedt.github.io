class Dictionary{dictionary=[];constructor(t){for(var e of t.slice(1))this.dictionary.push(new Word(e,t[0]))}get_random_word(t,e,s){var r=this.dictionary.filter((r=>!(t&&r.part_of_speech!==t||s&&r.syllables!==s||e&&r.form!==e)));return r.length>0?Util.choose(r):null}}class Haiku{dictionary;template_book;verses=[];constructor(t,e){for(this.dictionary=t,this.template_book=e;;){for(var s of[5,7,5])this.verses.push(new Verse(this.dictionary,this.template_book,s));if(this.cash_phrases_total())break;this.verses=[]}}to_str(){var t=this.verses.map((t=>t.to_str())).join("<br>");return t.endsWith("&comma;")&&(t=t.slice(0,-7)+"."),t}cash_phrases_total(){var t=0;for(var e of this.verses)t+=e.cash_phrases_total();return t}}class Haiku_Book{dictionary;template_book;haikus=[];current_index=-1;max_haikus=1e3;constructor(t,e){this.dictionary=t,this.template_book=e}generate_haiku(){return this._create_new_haiku(),this.current_index=this.haikus.length-1,this.haikus[this.current_index]}get_next_haiku(){return this.current_index<this.haikus.length-1&&(this.current_index+=1),this.haikus[this.current_index]}get_prev_haiku(){return this.current_index>0&&(this.current_index-=1),this.haikus[this.current_index]}_create_new_haiku(){this.haikus.push(new Haiku(this.dictionary,this.template_book)),this.haikus.length>this.max_haikus&&(this.haikus.shift(),this.current_index-=1)}}var dictionary,template_book,haiku_book,xmlhttp=new XMLHttpRequest;function generate_haiku(){haiku_display("generate")}function haiku_display(t){if("Generate!"==document.getElementById("generate_button").innerHTML){var e;switch(t){case"next":e=haiku_book.get_next_haiku();break;case"prev":e=haiku_book.get_prev_haiku();break;case"generate":e=haiku_book.generate_haiku()}e&&(document.getElementById("text").innerHTML=e.to_str())}}xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(myObj=JSON.parse(this.responseText))},xmlhttp.open("GET","data.json",!0),xmlhttp.send(),xmlhttp.onload=function(){dictionary=new Dictionary(myObj[0]),template_book=new Template_Book(myObj[1]),haiku_book=new Haiku_Book(dictionary,template_book),document.getElementById("generate_button").innerHTML="Generate!"},document.addEventListener("keydown",(function(t){switch(t.code){case"ArrowLeft":haiku_display("prev");break;case"ArrowRight":haiku_display("next")}}));class Template{constructor(t,e){for(var s=0;s<t.length;s++)this[e[s]]=t[s];this.used=0}add_used(){this.used+=1}}class Template_Book{template_book=[];constructor(t){for(var e of t.slice(1))this.template_book.push(new Word(e,t[0]))}get_random_template(){return Util.choose(this.template_book)}}class Util{static choose(t){return t[Math.floor(t.length*Math.random())]}static sum(t){return t.reduce((function(t,e){return t+e}),0)}static randint(t,e){return Math.floor(Math.random()*(e-t))+t}static split(t,e){var s=t.indexOf(e);return[t.substring(0,s),t.substring(s+e.length)]}static is_capitalized(t){return/^[A-Z]/.test(t)}}class Verse{dictionary;template_book;syllables;words;word_caps;separators;template;constructor(t,e,s){var r;this.dictionary=t,this.template_book=e,this.syllables=s;do{r=this.try_template()}while(!r);for(var i of(this.template.add_used(),this.words))i.add_used()}try_template(t){this.template=this.template_book.get_random_template(),this.words=[],this.word_caps=[],this.separators=[];var e=this.template.template;t=this.syllables;t-=this.template.syllables;var s=new Array(this.template.substitutions).fill(1);if(s.length>1)for(;Util.sum(s)<t;)s[Util.randint(0,s.length)]+=1;else s[0]=t;for(var r=0;e.length>0;){if(!e.includes("<")){this.separators.push(e);break}var i,a,o;[i,e]=Util.split(e,"<"),[a,e]=Util.split(e,">"),this.separators.push(i),a.includes(" ")?[a,o]=a.split(" "):o="",this.word_caps.push(Util.is_capitalized(a));var h=this.dictionary.get_random_word(a.toLowerCase(),o,s[r]);if(r+=1,!h)return!1;this.words.push(h)}return!0}to_str(){for(var t=[],e=0;e<this.words.length;e++)t.push(this.separators[e]),t.push(this.words[e].to_str(this.word_caps[e]));return t.push(this.separators[this.separators.length-1]),t.join("")}cash_phrases_total(){var t=0;for(var e of this.words)t+=e.cash_phrase;return t}}class Word{constructor(t,e){for(var s=0;s<t.length;s++)this[e[s]]=t[s];this.used=0}add_used(){this.used+=1}to_str(t=!1){var e=this.phrase;return t&&(e=e.charAt(0).toUpperCase()+e.slice(1)),this.definition?'<a href="'+this.link+'" title="'+this.definition+'" target="_blank">'+e+"</a>":e}}