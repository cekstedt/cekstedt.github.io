class Dictionary{dictionary=[];constructor(t){for(var s of t.slice(1))this.dictionary.push(new Word(s,t[0]))}get_random_word(t,s,e){var r=this.dictionary.filter((r=>!(t&&r.part_of_speech!==t||e&&r.syllables!==e||s&&r.form!==s)));return r.length>0?Util.choose(r):null}}class Haiku{dictionary;template_book;verses=[];constructor(t,s){for(this.dictionary=t,this.template_book=s;;){for(var e of[5,7,5])this.verses.push(new Verse(this.dictionary,this.template_book,e));if(this.cash_phrases_total())break;verses=[]}}to_str(){var t=this.verses.map((t=>t.to_str())).join("<br>");return t.endsWith("&comma;")&&(t=t.slice(0,-7)+"."),t}cash_phrases_total(){var t=0;for(var s of this.verses)t+=s.cash_phrases_total();return t}}var dictionary,template_book,xmlhttp=new XMLHttpRequest;function generate_haiku(){if("Generate!"==document.getElementById("button").innerHTML){var t=new Haiku(dictionary,template_book);document.getElementById("text").innerHTML=t.to_str()}}xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(myObj=JSON.parse(this.responseText))},xmlhttp.open("GET","data.json",!0),xmlhttp.send(),xmlhttp.onload=function(){dictionary=new Dictionary(myObj[0]),template_book=new Template_Book(myObj[1]),document.getElementById("button").innerHTML="Generate!"};class Template{constructor(t,s){for(var e=0;e<t.length;e++)this[s[e]]=t[e];this.used=0}add_used(){this.used+=1}}class Template_Book{template_book=[];constructor(t){for(var s of t.slice(1))this.template_book.push(new Word(s,t[0]))}get_random_template(){return Util.choose(this.template_book)}}class Util{static choose(t){return t[Math.floor(t.length*Math.random())]}static sum(t){return t.reduce((function(t,s){return t+s}),0)}static randint(t,s){return Math.floor(Math.random()*(s-t))+t}static split(t,s){var e=t.indexOf(s);return[t.substring(0,e),t.substring(e+s.length)]}static is_capitalized(t){return/^[A-Z]/.test(t)}}class Verse{dictionary;template_book;syllables;words;word_caps;separators;template;constructor(t,s,e){var r;this.dictionary=t,this.template_book=s,this.syllables=e;do{r=this.try_template()}while(!r);for(var a of(this.template.add_used(),this.words))a.add_used()}try_template(t){this.template=this.template_book.get_random_template(),this.words=[],this.word_caps=[],this.separators=[];var s=this.template.template;t=this.syllables;t-=this.template.syllables;var e=new Array(this.template.substitutions).fill(1);if(e.length>1)for(;Util.sum(e)<t;)e[Util.randint(0,e.length)]+=1;else e[0]=t;for(var r=0;s.length>0;){if(!s.includes("<")){this.separators.push(s);break}var a,o,i;[a,s]=Util.split(s,"<"),[o,s]=Util.split(s,">"),this.separators.push(a),o.includes(" ")?[o,i]=o.split(" "):i="",this.word_caps.push(Util.is_capitalized(o));var n=this.dictionary.get_random_word(o.toLowerCase(),i,e[r]);if(r+=1,!n)return!1;this.words.push(n)}return!0}to_str(){for(var t=[],s=0;s<this.words.length;s++)t.push(this.separators[s]),t.push(this.words[s].to_str(this.word_caps[s]));return t.push(this.separators[this.separators.length-1]),t.join("")}cash_phrases_total(){var t=0;for(var s of this.words)t+=s.cash_phrase;return t}}class Word{constructor(t,s){for(var e=0;e<t.length;e++)this[s[e]]=t[e];this.used=0}add_used(){this.used+=1}to_str(t=!1){var s=this.phrase;return t&&(s=s.charAt(0).toUpperCase()+s.slice(1)),this.definition?'<a href="'+this.link+'" title="'+this.definition+'" target="_blank">'+s+"</a>":s}}