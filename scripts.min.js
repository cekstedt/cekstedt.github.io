class Dictionary{dictionary=[];constructor(t){for(var e of t.slice(1))this.dictionary.push(new Word(e,t[0]))}get_random_word(t,e,s){var r=this.dictionary.filter((r=>!(t&&r.part_of_speech!==t||s&&r.syllables!==s||e&&r.form!==e)));return r.length>0?Util.choose(r):null}}class Haiku{dictionary;template_book;verses=[];constructor(t,e){for(var s of(this.dictionary=t,this.template_book=e,[5,7,5]))this.verses.push(new Verse(this.dictionary,this.template_book,s))}to_str(){var t=this.verses.map((t=>t.to_str())).join("<br>");return t.endsWith("&comma;")&&(t=t.slice(0,-7)+"."),t}}var dictionary,template_book,xmlhttp=new XMLHttpRequest;function generate_haiku(){if("Generate!"==document.getElementById("button").innerHTML){var t=new Haiku(dictionary,template_book);document.getElementById("text").innerHTML=t.to_str()}}xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(myObj=JSON.parse(this.responseText))},xmlhttp.open("GET","data.json",!0),xmlhttp.send(),xmlhttp.onload=function(){dictionary=new Dictionary(myObj[0]),template_book=new Template_Book(myObj[1]),document.getElementById("button").innerHTML="Generate!"};class Template{constructor(t,e){for(var s=0;s<t.length;s++)this[e[s]]=t[s];this.used=0}add_used(){this.used+=1}}class Template_Book{template_book=[];constructor(t){for(var e of t.slice(1))this.template_book.push(new Word(e,t[0]))}get_random_template(){return Util.choose(this.template_book)}}class Util{static choose(t){return t[Math.floor(t.length*Math.random())]}static sum(t){return t.reduce((function(t,e){return t+e}),0)}static randint(t,e){return Math.floor(Math.random()*(e-t))+t}static split(t,e){var s=t.indexOf(e);return[t.substring(0,s),t.substring(s+e.length)]}static is_capitalized(t){return/^[A-Z]/.test(t)}}class Verse{dictionary;template_book;syllables;words;word_caps;separators;template;constructor(t,e,s){var r;this.dictionary=t,this.template_book=e,this.syllables=s;do{r=this.try_template()}while(!r);for(var a of(this.template.add_used(),this.words))a.add_used()}try_template(t){this.template=this.template_book.get_random_template(),this.words=[],this.word_caps=[],this.separators=[];var e=this.template.template;t=this.syllables;t-=this.template.syllables;var s=new Array(this.template.substitutions).fill(1);if(s.length>1)for(;Util.sum(s)<t;)s[Util.randint(0,s.length)]+=1;else s[0]=t;for(var r=0;e.length>0;){if(!e.includes("<")){this.separators.push(e);break}var a,i,o;[a,e]=Util.split(e,"<"),[i,e]=Util.split(e,">"),this.separators.push(a),i.includes(" ")?[i,o]=i.split(" "):o="",this.word_caps.push(Util.is_capitalized(i));var n=this.dictionary.get_random_word(i.toLowerCase(),o,s[r]);if(r+=1,!n)return!1;this.words.push(n)}return!0}to_str(){for(var t=[],e=0;e<this.words.length;e++)t.push(this.separators[e]),t.push(this.words[e].to_str(this.word_caps[e]));return t.push(this.separators[this.separators.length-1]),t.join("")}}class Word{constructor(t,e){for(var s=0;s<t.length;s++)this[e[s]]=t[s];this.used=0}add_used(){this.used+=1}to_str(t=!1){var e=this.phrase;return t&&(e=e.charAt(0).toUpperCase()+e.slice(1)),this.definition?'<a href="'+this.link+'" title="'+this.definition+'" target="_blank">'+e+"</a>":e}}